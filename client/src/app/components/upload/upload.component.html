<!-- upload.component.html -->
<app-sidebar [isOpen]="isSidebarOpen" (toggle)="toggleSidebar()" />

@if (!isSidebarOpen) {
<button class="mobile-toggle" (click)="toggleSidebar()">
  <mat-icon>menu</mat-icon>
</button>
}
@else {
<button class="mobile-toggle" (click)="toggleSidebar()">
  <mat-icon>close</mat-icon>
</button>
}

<div class="upload-root">
  <main class="content">
    <div class="container">
      <header class="header">
        <h1>Upload Your Track</h1>
        <p class="subtitle">Share your music with the world</p>
      </header>

      <form [formGroup]="submitFg" (ngSubmit)="submit()" class="form">
        <!-- audio card -->
        <section class="card">
          <div class="card-head">
            <h3>Audio File</h3>
            <p class="muted">Upload your audio file (MP3, WAV, FLAC)</p>
          </div>

          <div class="card-body">
            <div class="dropzone" [class.active]="dragActive" [class.has-file]="uploadedFile"
              (dragenter)="handleDrag($event)" (dragover)="handleDrag($event)" (dragleave)="handleDrag($event)"
              (drop)="handleDrop($event)">

              <ng-container *ngIf="uploadedFile; else emptyDrop">
                <div class="file-info">
                  <div class="icon">üéß</div>
                  <div class="meta">
                    <div class="name">{{ uploadedFile.name }}</div>
                    <div class="size">{{ (uploadedFile.size / (1024*1024)).toFixed(2) }} MB</div>
                  </div>
                  <button type="button" class="btn small" (click)="uploadedFile = null">Remove</button>
                </div>
              </ng-container>

              <ng-template #emptyDrop>
                <div class="empty">
                  <div class="cloud">‚¨ÜÔ∏è</div>
                  <p class="lead">Drag and drop your audio file here</p>
                  <p class="muted">or</p>
                  <div class="actions">
                    <button type="button" class="btn outline" (click)="audioInput.click()">
                      Choose File
                    </button>
                    <input #audioInput id="audio-input" type="file" accept="audio/*" (change)="handleFileInput($event)"
                      hidden />
                  </div>
                </div>
              </ng-template>
            </div>
          </div>
        </section>

        <!-- cover card -->
        <section class="card">
          <div class="card-head">
            <h3>Cover Image</h3>
            <p class="muted">Add artwork for your track (recommended: 800√ó800)</p>
          </div>

          <div class="card-body cover-area">
            <ng-container *ngIf="coverPreview; else coverPlaceholder">
              <div class="preview">
                <img [src]="coverPreview" alt="cover preview" />
                <div class="preview-actions">
                  <button type="button" class="btn destructive" (click)="removeCover()">Remove</button>
                </div>
              </div>
            </ng-container>

            <ng-template #coverPlaceholder>
              <label class="cover-placeholder" for="cover-input">
                <!-- SVG picture icon -->
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" aria-hidden>
                  <path d="M3 7a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7z"
                    stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round" />
                  <path d="M8 13l2.5-3 3.5 4L16 11l3 4" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"
                    stroke-linejoin="round" />
                </svg>

                <div class="placeholder-text">
                  <strong>Upload Cover</strong>
                  <span class="muted">Click to choose an image</span>
                </div>
                <input #coverInput id="cover-input" type="file" accept="image/*" (change)="handleCoverImage($event)"
                  hidden />
              </label>
            </ng-template>

            <!-- optional instructions or size note -->
            <div class="cover-help muted">
              Recommended: 800√ó800, max 5MB
            </div>
          </div>
        </section>

        <!-- details card -->
        <section class="card">
          <div class="card-head">
            <h3>Track Details</h3>
            <p class="muted">Add information about your track</p>
          </div>

          <div class="card-body">
            <label class="field">
              <span class="label">File name</span>
              <input formControlName="fileNameCtrl" class="input" placeholder="Enter file name (optional)" />
            </label>

            <div class="field">
              <span class="label">Genres</span>
              <div class="badges">
                <button *ngFor="let genre of GENRES" type="button" class="badge"
                  [class.active]="(GenresCtrl.value || []).includes(genre)" (click)="toggleGenre(genre)">
                  {{genre}}
                </button>
              </div>
            </div>

            <div class="field">
              <span class="label">Moods</span>
              <div class="badges">
                <button *ngFor="let mood of MOODS" type="button" class="badge"
                  [class.active]="(MoodsCtrl.value || []).includes(mood)" (click)="toggleMood(mood)">{{mood}}</button>
              </div>
            </div>

            <div class="field">
              <span class="label">Tags</span>
              <div class="tag-input">
                <input formControlName="tagsInputCtrl" (keydown.enter)="$event.preventDefault(); addTag()" class="input"
                  placeholder="e.g., summer, vibes" />
                <button type="button" class="btn outline" (click)="addTag()">Add</button>
              </div>

              <div class="tag-list" *ngIf="TagsCtrl.value && TagsCtrl.value.length">
                <span class="tag" *ngFor="let t of TagsCtrl.value">
                  {{t}} <button type="button" class="rm" (click)="removeTag(t)">√ó</button>
                </span>
              </div>
            </div>
          </div>
        </section>

        <div class="actions-row">
          <button type="submit" class="btn primary"
            [disabled]="!uploadedFile || !submitFg.value.fileNameCtrl || (GenresCtrl.length === 0)">
            Upload Track
          </button>
        </div>
      </form>
    </div>
  </main>
</div>